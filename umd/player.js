!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("flv.lm.js"),require("hls.js"),require("prop-types"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","react","flv.lm.js","hls.js","prop-types","react-dom"],t):t((e=e||self).LMPlayer={},e.React,e.flvjs,e.Hls,e.PropTypes$1,e.ReactDOM)}(this,function(e,v,l,i,t,o){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}v=v&&v.hasOwnProperty("default")?v.default:v,l=l&&l.hasOwnProperty("default")?l.default:l,t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var a=function(){function t(e){s(this,t),this.video=e,this.events={},this.playerEvents={}}return u(t,[{key:"on",value:function(e,t){this.events&&this.events[e]?this.events[e].listener.push(t):this.events[e]={type:e,listener:[t]}}},{key:"addEventListener",value:function(e,t){this.video&&(this.playerEvents[e]?this.playerEvents[e].push(t):this.playerEvents[e]=[t],this.video.addEventListener(e,t,!1))}},{key:"removeEventListener",value:function(e,t){if(this.video){if(!this.playerEvents||!this.playerEvents[e])return;var n=this.playerEvents[e].findIndex(function(e){return e===t});-1<n&&this.playerEvents[e].splice(n,1),this.video.removeEventListener(e,t,!1)}}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.events&&this.events[e]&&this.events[e].listener.forEach(function(e){e.apply(void 0,n)})}},{key:"off",value:function(e,t){if(this.events&&this.events.eventName){var n=this.events[e].listener.findIndex(function(e){return e===t});-1<n&&this.events[e].listener.splice(n,1)}}},{key:"getApi",value:function(){return{on:this.on.bind(this),off:this.off.bind(this),emit:this.emit.bind(this)}}},{key:"destroy",value:function(){var n=this;Object.keys(this.playerEvents).forEach(function(t){n.playerEvents[t].forEach(function(e){n.removeEventListener(t,e)})}),this.playerEvents={},this.events={}}}]),t}();function y(e,t){if(i.isSupported()){var n=new i({liveDurationInfinity:!0,levelLoadingTimeOut:15e3,fragLoadingTimeOut:25e3,enableWorker:!0});return n.loadSource(t),n.attachMedia(e),n}}function g(e,t){var n=t.flvOptions,r=void 0===n?{}:n,i=t.flvConfig,a=void 0===i?{}:i;if(l.isSupported()){var o=l.createPlayer(Object.assign({},r,{type:"flv",url:t.file}),Object.assign({},a,{enableWorker:!0,enableStashBuffer:!1,stashInitialSize:128,isLive:t.isLive||!0}));return o.attachMediaElement(e),o.load(),o}}function E(e){var t=new URL(e),n="".concat(t.origin).concat(t.pathname),r=/([^\.\/\\]+)\.(([a-z]|[0-9])+(\?\S+)?)$/i.exec(n);if(!r)return-1<e.indexOf(".flv")?"flv":"hls";var i=r[2].replace(r[4],"");return i||(-1<e.indexOf(".flv")?"flv":"hls")}function b(e){return e&&(document.fullscreenElement===e||document.msFullscreenElement===e||document.mozFullScreenElement===e||document.webkitFullscreenElement===e)||!1}function P(e,t){var n=e?"addEventListener":"removeEventListener";["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"].map(function(e){return document[n](e,t)})}function L(e,t,n){var r,i,a=t,o=e.getBoundingClientRect(),l=o.width,s=o.height;if(1===n)return[0,0];r=l*(n-1)/2/n,i=s*(n-1)/2/n;var u=0,c=0;return 0<=a[0]&&a[0]>r&&(u=r),0<=a[0]&&a[0]<r&&(u=a[0]),a[0]<0&&a[0]<-r&&(u=-r),a[0]<0&&a[0]>-r&&(u=a[0]),0<=a[1]&&a[1]>i&&(c=i),0<=a[1]&&a[1]<i&&(c=a[1]),a[1]<0&&a[1]<-i&&(c=-i),a[1]<0&&a[1]>-i&&(c=a[1]),u!==a[0]||c!==a[1]?[u,c]:void 0}var k=v.createContext(null),C=k.Provider,T=k.Consumer;function R(r){var n=function(){function e(){return s(this,e),m(this,h(e).apply(this,arguments))}return p(e,v.Component),u(e,[{key:"render",value:function(){var e=this.props,t=e.forwardRef,n=d(e,["forwardRef"]);return v.createElement(T,null,function(e){return v.createElement(r,c({},n,e,{ref:t}))})}}]),e}();return n.propTypes={forwardRef:t.ref},v.forwardRef(function(e,t){return v.createElement(n,c({},e,{forwardRef:t}))})}function S(e){var t=e.type,n=e.className,r=void 0===n?"":n,i=d(e,["type","className"]);return v.createElement("i",c({className:"lm-player-iconfont ".concat(t," ").concat(r)},i))}S.propTypes={type:t.string,className:t.string};var D=function(){function t(e){var l;return s(this,t),(l=m(this,h(t).call(this,e))).renderSliderTips=function(o){l.props.renderTips&&(clearTimeout(l.timer),l.timer=setTimeout(function(){var e=l.layoutDom.getBoundingClientRect(),t=e.x,n=e.width,r=e.top,i=o.pageX,a=(o.pageX-t)/n;a=a<0?0:1<a?1:a,l.setState({tipsX:i,tipsY:r,showTips:!0,tempValue:a})},200))},l.hideSliderTips=function(){clearTimeout(l.timer),l.setState({showTips:!1})},l.cancelPropagation=function(e){e.stopPropagation()},l.startDrag=function(e){e.stopPropagation(),l.dragFlag=!0,document.body.addEventListener("mousemove",l.moveChange),document.body.addEventListener("mouseup",l.stopDrag)},l.moveChange=function(e){e.stopPropagation();var t=l.computedPositionForEvent(e);l.setState({value:t})},l.stopDrag=function(e){e.stopPropagation(),document.body.removeEventListener("mousemove",l.moveChange),document.body.removeEventListener("mouseup",l.stopDrag),l.dragFlag=!1;var t=l.state.value/100;t=t<0?0:1<t?1:t,l.props.onChange&&l.props.onChange(t)},l.changeCurrentValue=function(e){e.stopPropagation();var t=l.layoutDom.getBoundingClientRect(),n=t.width,r=t.x,i=(e.pageX-r)/n;l.props.onChange&&l.props.onChange(i)},l.sliderDomRef=v.createRef(),l.layoutDom=null,l.lineDom=null,l.dragDom=null,l.dragFlag=!1,l.state={value:l.props.currentPercent||0,tempValue:0,showTips:!1,tipsX:0,tipsY:0},l}return p(t,v.Component),u(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.dragFlag||this.setState({value:e.currentPercent||0})}},{key:"componentDidMount",value:function(){this.layoutDom=this.sliderDomRef.current,this.dragDom=this.layoutDom.querySelector(".drag-change-icon"),this.lineDom=this.layoutDom.querySelector(".slider-content"),this.layoutDom.addEventListener("mousemove",this.renderSliderTips,!1),this.layoutDom.addEventListener("mouseout",this.hideSliderTips,!1),this.lineDom.addEventListener("click",this.changeCurrentValue,!1),this.dragDom.addEventListener("click",this.cancelPropagation,!1),this.dragDom.addEventListener("mousedown",this.startDrag,!1)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.layoutDom.removeEventListener("mousemove",this.renderSliderTips,!1),this.layoutDom.removeEventListener("mouseout",this.hideSliderTips,!1),this.lineDom.removeEventListener("click",this.changeCurrentValue,!1),this.dragDom.removeEventListener("click",this.cancelPropagation,!1),this.dragDom.removeEventListener("mousedown",this.startDrag,!1),document.body.removeEventListener("mousemove",this.moveChange),document.body.removeEventListener("mouseup",this.stopDrag),this.sliderDomRef=null,this.layoutDom=null,this.lineDom=null,this.dragDom=null,this.dragFlag=null}},{key:"computedPositionForEvent",value:function(e){var t=this.layoutDom.getBoundingClientRect(),n=t.x,r=t.width,i=e.pageX-n;return r<i&&(i=r),i<0&&(i=0),i/r*100}},{key:"render",value:function(){var e=this.state,t=e.value,n=e.showTips,r=e.tipsX,i=e.tipsY,a=this.props,o=a.availablePercent,l=void 0===o?0:o,s=a.className,u=void 0===s?"":s;return v.createElement("div",{className:"slider-layout ".concat(u),ref:this.sliderDomRef},v.createElement("div",{className:"slider-content"},v.createElement("div",{className:"slider-max-line"}),v.createElement("div",{className:"slider-visibel-line",style:{width:"".concat(l,"%")}}),v.createElement("div",{className:"slider-current-line",style:{width:"".concat(t,"%")}}),this.props.children),v.createElement("div",{className:"slider-other-content"},v.createElement("div",{className:"drag-change-icon",draggable:!1,style:{left:"".concat(t,"%")}})),v.createElement(O,{visibel:n,className:"lm-player-slide-tips",style:{left:r,top:i}},this.props.renderTips&&this.props.renderTips(this.state.tempValue)))}}]),t}();D.propTypes={currentPercent:t.number,seekTo:t.func,video:t.element,renderTips:func,availablePercent:t.number,onChange:t.func,children:t.any,className:t.string};var O=function(){function n(e){var t;return s(this,n),(t=m(this,h(n).call(this,e))).ele=document.createElement("div"),t}return p(n,v.Component),u(n,[{key:"componentDidMount",value:function(){document.body.appendChild(this.ele)}},{key:"componentWillUnmount",value:function(){document.body.removeChild(this.ele),this.ele=null}},{key:"render",value:function(){var e=this.props,t=e.visibel,n=e.children,r=e.style,i=e.className,a=void 0===i?"":i;return o.createPortal(t?v.createElement("div",{className:a,style:r},n):null,this.ele)}}]),n}();function I(e){var t=e.visibel,n=void 0===t||t,r=e.className,i=void 0===r?"":r,a=e.children,o=d(e,["visibel","className","children"]);return!1===n?null:v.createElement("span",c({className:"contraller-bar-item ".concat(i)},o),a)}O.propTypes={visibel:t.bool,children:t.element,style:t.any,className:t.string},I.propTypes={visibel:t.bool,className:t.string,children:t.any};var w,_,A={RELOAD:"reload",RELOAD_FAIL:"reloadFail",RELOAD_SUCCESS:"reloadSuccess",ERROR:"error",ERROR_RELOAD:"errorRload",HISTORY_PLAY_END:"historyPlayEnd",SEEK:"seek",TRANSFORM:"transform",CHANGE_PLAY_INDEX:"changePlayIndex",HIDE_CONTRALLER:"hideContraller",SHOW_CONTRALLER:"showContraller",CLEAR_ERROR_TIMER:"clearErrorTimer"},x=R(w=function(){function t(e){var i;return s(this,t),(i=m(this,h(t).call(this,e))).seek=function(){i.historyEnd=!1},i.historyPlayEnd=function(){i.historyEnd=!0},i.updateRender=function(){i.mounted&&i.forceUpdate()},i.changePlayStatus=function(){var e=i.props,t=e.api,n=e.video;i.historyEnd?i.props.reloadHistory():n.paused?t.play():t.pause()},i.mutedChange=function(){var e=i.props,t=e.api;e.video.muted?t.unmute():t.mute()},i.volumechange=function(){i.forceUpdate()},i.openSliderVolume=function(){i.setState({openSliderVolume:!0})},i.closeSliderVolume=function(){i.setState({openSliderVolume:!1})},i.onChangeVolume=function(e){var t=i.props,n=t.api,r=t.video;n.setVolume(parseFloat(e.toFixed(1))),0<e&&r.muted&&n.unmute()},i.reload=function(){i.props.isHistory?i.props.reloadHistory():i.props.api.reload(),i.props.event.emit(A.CLEAR_ERROR_TIMER)},i.state={openSliderVolume:!1},i.historyEnd=!1,i.mounted=!1,i}return p(t,v.Component),u(t,[{key:"componentDidMount",value:function(){var e=this.props.event;this.mounted=!0,e.addEventListener("play",this.updateRender),e.addEventListener("pause",this.updateRender),e.addEventListener("volumechange",this.volumechange),e.on(A.HISTORY_PLAY_END,this.historyPlayEnd),e.on(A.SEEK,this.seek)}},{key:"componentWillUnmount",value:function(){event.removeEventListener("play",this.updateRender),event.removeEventListener("pause",this.updateRender),event.removeEventListener("volumechange",this.volumechange),event.off(A.HISTORY_PLAY_END,this.historyPlayEnd),event.off(A.SEEK,this.seek)}},{key:"render",value:function(){var e=this.state.openSliderVolume,t=this.props,n=t.video,r=t.playerProps,i=r.isLive,a=r.leftExtContents,o=void 0===a?null:a,l=r.leftMidExtContents,s=void 0===l?null:l,u=1===n.volume?"lm-player-volume-max":"lm-player-volume-normal-fuben";return v.createElement("div",{className:"contraller-left-bar"},o,v.createElement(I,{visibel:!i},v.createElement(S,{onClick:this.changePlayStatus,type:n.paused?"lm-player-Play_Main":"lm-player-Pause_Main",title:n.paused?"播放":"暂停"})),v.createElement(I,{className:"contraller-bar-volume ".concat(e?"contraller-bar-hover-volume":""),onMouseOver:this.openSliderVolume,onMouseOut:this.closeSliderVolume},v.createElement(S,{onClick:this.mutedChange,type:n.muted?"lm-player-volume-close":u,title:"音量"}),v.createElement("div",{className:"volume-slider-layout"},v.createElement(D,{className:"volume-slider",currentPercent:n.muted?0:100*n.volume,onChange:this.onChangeVolume,renderTips:function(e){return v.createElement("span",null,Math.round(100*e),"%")}}))),v.createElement(I,null,v.createElement(S,{onClick:this.reload,type:"lm-player-Refresh_Main",title:"重载"})),s)}}]),t}())||w;x.propTypes={api:t.object,event:t.object,playerProps:t.object,video:t.node,reloadHistory:t.func,isHistory:t.bool};var N,F=R(_=function(){function a(){var e,i;s(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(i=m(this,(e=h(a)).call.apply(e,[this].concat(n)))).update=function(){i.forceUpdate()},i.fullscreen=function(){var e=i.props,t=e.api;b(e.playContainer)?t.cancelFullScreen():t.requestFullScreen(),i.forceUpdate()},i.setScale=function(){var e=i.props,t=e.api,n=e.playContainer.querySelector(".player-mask-layout");t.setScale.apply(t,arguments);var r=L(n,t.getPosition(),t.getScale());r&&t.setPosition(r,!0)},i.snapshot=function(){var e=i.props,t=e.api,n=e.playerProps;n.snapshot&&n.snapshot(t.snapshot())},i}return p(a,v.Component),u(a,[{key:"componentDidMount",value:function(){P(!0,this.update)}},{key:"componentWillUnmount",value:function(){P(!1,this.update)}},{key:"render",value:function(){var e=this,t=this.props,n=t.playContainer,r=t.playerProps,i=r.isScale,a=r.snapshot,o=r.rightExtContents,l=void 0===o?null:o,s=r.rightMidExtContents,u=void 0===s?null:s,c=b(n);return v.createElement("div",{className:"contraller-right-bar"},u,i&&v.createElement(v.Fragment,null,v.createElement(I,null,v.createElement(S,{title:"缩小",onClick:function(){return e.setScale(-.2)},type:"lm-player-ZoomOut_Main"})),v.createElement(I,null,v.createElement(S,{title:"复位",onClick:function(){return e.setScale(1,!0)},type:"lm-player-ZoomDefault_Main"})),v.createElement(I,null,v.createElement(S,{title:"放大",onClick:function(){return e.setScale(.2)},type:"lm-player-ZoomIn_Main"}))),a&&v.createElement(I,null,v.createElement(S,{title:"截图",onClick:this.snapshot,type:"lm-player-SearchBox"})),v.createElement(I,null,v.createElement(S,{title:c?"窗口":"全屏",onClick:this.fullscreen,type:c?"lm-player-ExitFull_Main":"lm-player-Full_Main"})),l)}}]),a}())||_;function M(e){var t=e.visibel;return v.createElement("div",{className:"contraller-bar-layout ".concat(t?"":"hide-contraller-bar")},v.createElement(x,null),v.createElement(F,null))}F.propTypes={api:t.object,event:t.object,playerProps:t.object,playContainer:t.node,reloadHistory:t.func,isHistory:t.bool},M.propTypes={visibel:t.bool};var j,H=R(N=function(){function n(e){var t;return s(this,n),(t=m(this,h(n).call(this,e))).showContraller=function(){if(!t.visibel){var e=t.props.event;t.visibel=!0,t.forceUpdate(),e.emit(A.SHOW_CONTRALLER)}t.hideContraller()},t.hideContraller=function(){var e=t.props.event;clearTimeout(t.timer),t.timer=setTimeout(function(){t.visibel=!1,e.emit(A.HIDE_CONTRALLER),t.forceUpdate()},3e3)},t.timer=null,t.visibel=!0,t}return p(n,v.Component),u(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.playContainer,n=e.event;t.addEventListener("mousemove",this.showContraller,!1),t.addEventListener("mouseout",this.hideContraller,!1),this.timer=setTimeout(function(){n.emit(A.HIDE_CONTRALLER)},5e3)}},{key:"componentWillUnmount",value:function(){var e=this.props.playContainer;e.addEventListener("mousemove",this.showContraller,!1),e.addEventListener("mouseout",this.hideContraller,!1),clearTimeout(this.timer)}},{key:"render",value:function(){var t=this,e=this.props.children;return v.Children.map(e,function(e){return v.isValidElement(e)?v.cloneElement(e,{visibel:t.visibel}):e})}}]),n}())||N;H.propTypes={api:t.object,event:t.object,playContainer:t.node,children:t.element};var U=R(j=function(){function n(e){var t;return s(this,n),(t=m(this,h(n).call(this,e))).clearReloadMessage=function(){t.message=null,t.mounted&&t.forceUpdate()},t.reload=function(){t.setState({status:"reload"})},t.errorReload=function(e){t.message=v.createElement("div",null,"视频加载错误，正在进行重连第",e,"重连"),t.mounted&&t.setState({status:"reload",loading:!0})},t.reloadFail=function(){t.message=v.createElement("div",null,"视频错误"),t.mounted&&t.setState({status:"fail"})},t.reloadSuccess=function(){t.message=null,t.mounted&&t.setState({status:null})},t.openLoading=function(){t.mounted&&t.setState({loading:!0})},t.closeLoading=function(){t.mounted&&t.setState({loading:!1})},t.historyPlayEnd=function(){t.message=null,t.mounted&&t.setState({status:null,loading:!1}),t.props.api.pause()},t.state={loading:!1,status:null},t.mounted=!1,t.message=null,t}return p(n,v.Component),u(n,[{key:"componentDidMount",value:function(){var e=this.props.event;this.mounted=!0,e.addEventListener("loadstart",this.openLoading),e.addEventListener("waiting",this.openLoading),e.addEventListener("seeking",this.openLoading),e.addEventListener("loadeddata",this.closeLoading),e.addEventListener("canplay",this.closeLoading),e.on(A.ERROR_RELOAD,this.errorReload),e.on(A.RELOAD_FAIL,this.reloadFail),e.on(A.RELOAD_SUCCESS,this.reloadSuccess),e.on(A.RELOAD,this.reload),e.on(A.HISTORY_PLAY_END,this.historyPlayEnd),e.on(A.CLEAR_ERROR_TIMER,this.clearReloadMessage)}},{key:"componentWillUnmount",value:function(){event.removeEventListener("loadstart",this.openLoading),event.removeEventListener("waiting",this.openLoading),event.removeEventListener("seeking",this.openLoading),event.removeEventListener("loadeddata",this.closeLoading),event.removeEventListener("canplay",this.closeLoading),event.off(A.ERROR_RELOAD,this.errorReload),event.off(A.RELOAD_FAIL,this.reloadFail),event.off(A.RELOAD_SUCCESS,this.reloadSuccess),event.off(A.RELOAD,this.reload),event.off(A.HISTORY_PLAY_END,this.historyPlayEnd),event.off(A.CLEAR_ERROR_TIMER,this.clearReloadMessage)}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.status;return v.createElement("div",{className:"lm-player-message-mask ".concat(t||"fail"===n?"lm-player-mask-loading-animation":"")},v.createElement(S,{type:"fail"===n?"lm-player-YesorNo_No_Dark":"lm-player-Loading",className:"".concat(t&&"fail"!==n?"lm-player-loading-animation":"fail"===n?"lm-player-loadfail":""," lm-player-loading-icon")}),v.createElement("span",{className:"lm-player-message"},this.message))}}]),n}())||j;U.propTypes={api:PropTypes.object,event:PropTypes.object};function q(){return v.createElement("div",{className:"lm-player-message-mask lm-player-mask-loading-animation"},v.createElement(S,{style:{fontSize:80},type:"lm-player-PlaySource",title:"请选择视频源"}))}var W,V,Y=R(W=function(){function t(e){var r;return s(this,t),(r=m(this,h(t).call(this,e))).getDuration=function(){var e=r.props.api;r.setState({duration:e.getDuration()})},r.getCurrentTime=function(){var e=r.props.api,t={currentTime:e.getCurrentTime(),buffered:e.getSecondsLoaded()};t.buffered===r.state.buffered&&delete t.buffered,r.setState(t)},r.getBuffered=function(){var e=r.props.api;r.setState({buffered:e.getSecondsLoaded()})},r.changePlayTime=function(e){var t=r.props.api,n=e*r.state.duration;t.pause(),r.setState({currentTime:n}),t.seekTo(n)},r.seekendPlay=function(){r.props.api.play()},r.renderTimeLineTips=function(e){var t=function(e){var t=Math.ceil(e);if(60<t){var n=Math.ceil(e%60),r=Math.floor(e/60);if(t="".concat(r<10?"0".concat(r):r,":").concat(n<10?"0".concat(n):n),60<r){r=Math.ceil(e/60%60);var i=Math.floor(e/60/60);t="".concat(i<10?"0".concat(i):i,":").concat(r<10?"0".concat(r):r,":").concat(n<10?"0".concat(n):n)}else t="00:".concat(t)}else t="00:00:".concat(t<10?"0".concat(t):t);return t}(e*r.state.duration);return v.createElement("span",null,t)},r.fastForward=function(){r.props.api.fastForward()},r.backWind=function(){r.props.api.backWind()},r.state={duration:0,currentTime:0,buffered:0},r}return p(t,v.Component),u(t,[{key:"componentDidMount",value:function(){var e=this.props.event;e.addEventListener("loadedmetadata",this.getDuration),e.addEventListener("durationchange",this.getDuration),e.addEventListener("timeupdate",this.getCurrentTime),e.addEventListener("progress",this.getBuffered),e.addEventListener("suspend",this.getBuffered),e.addEventListener("seeked",this.seekendPlay)}},{key:"render",value:function(){var e=this.state,t=e.duration,n=e.currentTime,r=e.buffered,i=Math.round(n/t*100),a=Math.round(r/t*100);return v.createElement("div",{className:"video-time-line-layout ".concat(this.props.visibel?"":"hide-time-line")},v.createElement(S,{type:"lm-player-PrevFast",onClick:this.backWind,className:"time-line-action-item"}),v.createElement(D,{className:"time-line-box",currentPercent:i,availablePercent:a,onChange:this.changePlayTime,renderTips:this.renderTimeLineTips}),v.createElement(S,{type:"lm-player-NextFast_Light",onClick:this.fastForward,className:"time-line-action-item"}))}}]),t}())||W;Y.propTypes={event:t.object,api:t.object,changePlayIndex:t.func,playIndex:t.number,historyList:t.array,seekTo:t.func,video:t.element,visibel:t.bool};var B,z=R(V=function(){function t(e){var d;return s(this,t),(d=m(this,h(t).call(this,e))).clearErrorTimer=function(){d.errorTimer=0,clearTimeout(d.reconnectTimer)},d.clearError=function(){var e=d.props.event;0<d.errorTimer&&(console.warn("视频重连成功！"),e.emit(A.RELOAD_SUCCESS),d.clearErrorTimer())},d.errorHandle=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,n),clearTimeout(d.reconnectTimer);var i=d.props,a=i.event,o=i.api,l=i.isHistory,s=i.changePlayIndex,u=i.playIndex,c=i.playerProps,p=d.errorTimer+1;a.emit.apply(a,[A.ERROR].concat(n)),p>c.errorReloadTimer?(l?s(u+1):a.emit(A.RELOAD_FAIL),o.unload()):(d.errorTimer=p,(n[1]&&n[1].loader||n[0].indexOf&&-1<n[0].indexOf("NetworkError"))&&d.reloadAction(p,n),d.reconnectTimer=setTimeout(function(){d.reloadAction(p,n)},2e4))},d.reloadAction=function(e,t){var n=d.props,r=n.event,i=n.api,a=n.hlsPlayer;r.emit.apply(r,[A.ERROR_RELOAD,e].concat(f(t))),console.warn("视频播放出错，正在进行重连".concat(e)),a&&(a.swapAudioCodec(),a.recoverMediaError()),i.reload()},d.errorTimer=0,d}return p(t,v.Component),u(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.event,n=e.flvPlayer,r=e.hlsPlayer;n&&n.on(l.Events.ERROR,this.errorHandle),r&&r.on(i.Events.ERROR,this.errorHandle),t.addEventListener("error",this.errorHandle,!1),t.addEventListener("canplay",this.clearError,!1),t.on(A.CHANGE_PLAY_INDEX,this.clearErrorTimer),t.on(A.CLEAR_ERROR_TIMER,this.clearErrorTimer)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.flvPlayer&&e.flvPlayer!==this.props.flvPlayer&&e.flvPlayer.on(l.Events.ERROR,this.errorHandle),e.hlsPlayer&&e.hlsPlayer!==this.props.hlsPlayer&&e.hlsPlayer.on(i.Events.ERROR,this.errorHandle)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.reconnectTimer)}},{key:"render",value:function(){return null}}]),t}())||V;z.propTypes={api:t.object,event:t.object,playContainer:t.node,playerProps:t.object,hlsPlayer:t.object,flvPlayer:t.object,isHistory:t.bool,changePlayIndex:t.func,playIndex:t.number};var X=R(B=function(){function n(e){var i;s(this,n),(i=m(this,h(n).call(this,e))).openDrag=function(e){i.position.start=[e.pageX,e.pageY],i.dragDom.addEventListener("mousemove",i.moveChange),i.dragDom.addEventListener("mouseup",i.stopDrag)},i.moveChange=function(e){var t=i.props.api,n=t.getPosition();i.position.end=[e.pageX,e.pageY];var r=[n[0]+(i.position.end[0]-i.position.start[0]),n[1]+(i.position.end[1]-i.position.start[1])];t.setPosition(r),i.position.start=[e.pageX,e.pageY]},i.stopDrag=function(){i.dragDom.removeEventListener("mousemove",i.moveChange),i.dragDom.removeEventListener("mouseup",i.stopDrag),i.transformChange()},i.transformChange=function(){var e=i.props.api,t=L(i.dragDom,e.getPosition(),e.getScale());t&&e.setPosition(t,!0)};var t=e.playContainer;return i.dragDom=t.querySelector(".player-mask-layout"),i.position={start:[0,0],end:[0,0]},i}return p(n,v.Component),u(n,[{key:"componentDidMount",value:function(){this.props.playerProps.isDraggable&&(this.dragDom.addEventListener("mousedown",this.openDrag),this.props.event.addEventListener("transform",this.transformChange,!0))}},{key:"componentWillUnmount",value:function(){this.dragDom.removeEventListener("mousedown",this.openDrag)}},{key:"render",value:function(){return null}}]),n}())||B;X.propTypes={api:t.object,event:t.object,playContainer:t.node,playerProps:t.object};var K=function(){function a(e,t,n,r,i){s(this,a),this.player=e,this.playContainer=t,this.flv=r,this.hls=i,this.event=n,this.scale=1,this.position=[0,0]}return u(a,[{key:"updateChunk",value:function(e){var t=e.flv,n=e.hls;this.flv=t,this.hls=n}},{key:"requestFullScreen",value:function(){var e;b(this.playContainer)||((e=this.playContainer).requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen())}},{key:"cancelFullScreen",value:function(){b(this.playContainer)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())}},{key:"play",value:function(){this.player.paused&&this.player.play()}},{key:"pause",value:function(){this.player.paused||this.player.pause()}},{key:"destroy",value:function(){this.player.removeAttribute("src"),this.unload(),this.flv&&this.flv.destroy(),this.hls&&this.hls.destroy()}},{key:"seekTo",value:function(e,t){var n=this.getBufferedTime();this.flv&&n[0]>e&&(this.flv.unload(),this.flv.load()),this.player.currentTime=e,t||this.event.emit(A.SEEK,e)}},{key:"reload",value:function(){this.unload(),this.load(),this.play(),this.event.emit(A.RELOAD),0!==this.getCurrentTime&&this.seekTo(0)}},{key:"unload",value:function(){this.flv&&this.flv.unload(),this.hls&&this.hls.stopLoad()}},{key:"load",value:function(){if(this.flv&&this.flv.load(),this.hls){try{this.hls.swapAudioCodec(),this.hls.recoverMediaError()}catch(e){console.warn(e)}this.hls.startLoad()}}},{key:"setVolume",value:function(e){this.player.volume=e}},{key:"mute",value:function(){this.player.muted=!0}},{key:"unmute",value:function(){this.player.muted=!1}},{key:"requestPictureInPicture",value:function(){this.player.requestPictureInPicture&&document.pictureInPictureElement!==this.player&&this.player.requestPictureInPicture()}},{key:"exitPictureInPicture",value:function(){document.exitPictureInPicture&&document.pictureInPictureElement===this.player&&document.exitPictureInPicture()}},{key:"setPlaybackRate",value:function(e){this.player.playbackRate=e}},{key:"getDuration",value:function(){if(!this.player)return null;var e=this.player,t=e.duration,n=e.seekable;return t===1/0&&0<n.length?n.end(n.length-1):t}},{key:"getCurrentTime",value:function(){return this.player?this.player.currentTime:null}},{key:"getSecondsLoaded",value:function(){return this.getBufferedTime()[1]}},{key:"getBufferedTime",value:function(){if(!this.player)return null;var e=this.player.buffered;if(0===e.length)return[0,0];var t=e.end(e.length-1),n=e.start(e.length-1),r=this.getDuration();return r<t?r:[n,t]}},{key:"fastForward",value:function(e){var t=0<arguments.length&&void 0!==e?e:5,n=this.getDuration(),r=this.getCurrentTime()+t;this.seekTo(n-1<r?n-1:r)}},{key:"backWind",value:function(e){var t=0<arguments.length&&void 0!==e?e:5,n=this.getCurrentTime()-t;this.seekTo(n<1?1:n)}},{key:"snapshot",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.player.videoWidth,e.height=this.player.videoHeight,t.drawImage(this.player,0,0,e.width,e.height),setTimeout(function(){e.remove(),t=e=null},200),e.toDataURL()}},{key:"setScale",value:function(e,t){var n=this,r=1<arguments.length&&void 0!==t&&t,i=this.scale+e;r?i=e:(i<1&&(i=1),3<i&&(i=3)),this.scale=i,this.player.style.transition="transform 0.3s",this.__setTransform(),this.event.emit(A.TRANSFORM),setTimeout(function(){n.player.style.transition="unset"},500)}},{key:"getScale",value:function(){return this.scale}},{key:"setPosition",value:function(e,t){this.position=e,this.player.style.transition=t?"transform 0.3s":"unset",this.__setTransform()}},{key:"getPosition",value:function(){return this.position}},{key:"__setTransform",value:function(){this.player.style.transform="scale(".concat(this.scale,") translate(").concat(this.position[0],"px,").concat(this.position[1],"px)")}},{key:"getApi",value:function(){return{play:this.play.bind(this),reload:this.reload.bind(this),pause:this.pause.bind(this),seekTo:this.seekTo.bind(this),setVolume:this.setVolume.bind(this),mute:this.mute.bind(this),unmute:this.unmute.bind(this),requestPictureInPicture:this.requestPictureInPicture.bind(this),exitPictureInPicture:this.exitPictureInPicture.bind(this),setPlaybackRate:this.setPlaybackRate.bind(this),destroy:this.destroy.bind(this),getDuration:this.getDuration.bind(this),getCurrentTime:this.getCurrentTime.bind(this),getSecondsLoaded:this.getSecondsLoaded.bind(this),getBufferedTime:this.getBufferedTime.bind(this),fastForward:this.fastForward.bind(this),backWind:this.backWind.bind(this),snapshot:this.snapshot.bind(this),requestFullScreen:this.requestFullScreen.bind(this),cancelFullScreen:this.cancelFullScreen.bind(this),__player:this.player,flv:this.flv,hls:this.hls}}}]),a}();function G(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}var Z,$={addEventListener:function(e){var t=G().replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(t,e,!1)},removeEventListener:function(e){var t=G().replace(/[H|h]idden/,"")+"visibilitychange";document.removeEventListener(t,e,!1)},visibilityState:function(){return document[function(){var e=["webkit","moz","ms","o"];if("visibilityState"in document)return"visibilityState";for(var t=0;t<e.length;t++)if(e[t]+"VisibilityState"in document)return e[t]+"VisibilityState";return null}()]}},J=R(Z=function(){function t(e){var r;return s(this,t),(r=m(this,h(t).call(this,e))).browserTabChange=function(){"visible"===$.visibilityState()&&r.focusSeekAction()},r.canplay=function(){var e=r.props.api;r.isCanPlay=!0,e.play()},r.focusSeekAction=function(){var e=r.props.api,t=e.getCurrentTime(),n=e.getSecondsLoaded();5<n-t&&(console.warn("当前延时过大current->".concat(t," buffered->").concat(n,", 基于视频当前缓存时间更新当前播放时间 updateTime -> ").concat(n-2)),e.seekTo(0<n-2?n-2:0))},r.timer=null,r.isCanPlay=!1,r}return p(t,v.Component),u(t,[{key:"componentDidMount",value:function(){var e=this.props.event;$.addEventListener(this.browserTabChange),e.addEventListener("canplay",this.canplay)}},{key:"componentWillUnmount",value:function(){$.removeEventListener(this.browserTabChange)}},{key:"render",value:function(){return null}}]),t}())||Z;J.propTypes={api:t.object,event:t.object};var Q,ee=function(){function n(e){var t;return s(this,n),(t=m(this,h(n).call(this,e))).initPlayer=function(){if(!t.props.file)return!1;var e=E(t.props.file);return"flv"===e||"flv"===t.props.type?t.flv=g(t.player,t.props):"m3u8"===e||"hls"===t.props.type?t.hls=y(t.player,t.props.file):t.player.src=t.props.file,!0},t.renderVideoTools=function(){return t.isInit&&t.props.file&&t.api&&t.event?v.createElement(v.Fragment,null,v.createElement(M,null),v.createElement(U,null),v.createElement(X,null),v.createElement(H,null,v.createElement(M,null),!t.props.isLive&&v.createElement(Y,null)),v.createElement(z,{flvPlayer:t.flv,hlsPlayer:t.hls,key:"".concat(t.props.file,"_error")}),t.props.isLive&&v.createElement(J,{key:t.props.file})):v.createElement(q,null)},t.getPlayUrl=function(){return t.props.file},t.getPlayerApiContext=function(){return t.api&&t.event?Object.assign({},t.api.getApi(),t.event.getApi(),{getPlayUrl:t.getPlayUrl,playContainer:t.playContainer}):{}},t.getProvider=function(){return{video:t.player,event:t.event,playerProps:t.props,api:t.api,playContainer:t.playContainer}},t.player=null,t.event=null,t.flv=null,t.hls=null,t.api=null,t.playContainerRef=v.createRef(),t.playContainer=null,t.state={playChange:!1,file:null},t}return p(n,v.Component),u(n,[{key:"componentDidMount",value:function(){this.playContainer=this.playContainerRef.current,this.player=this.playContainer.querySelector("video"),this.createPlayer(),this.isInit=!0}},{key:"componentDidUpdate",value:function(){this.state.playChange&&(this.setState({playChange:!1}),this.createPlayer())}},{key:"componentWillUnmount",value:function(){this.event&&this.event.destroy(),this.api&&this.api.destroy()}},{key:"createPlayer",value:function(){this.initPlayer()&&(this.event=new a(this.player),this.api=new K(this.player,this.playContainer,this.event,this.flv,this.hls),this.props.onInitPlayer&&this.props.onInitPlayer(this.getPlayerApiContext()),this.forceUpdate())}},{key:"render",value:function(){var e=this.props,t=e.autoplay,n=e.poster,r=e.preload,i=void 0===r?"none":r,a=e.muted,o=void 0===a?"muted":a,l=e.className,s=void 0===l?"":l,u=e.loop,c=void 0!==u&&u,p=e.playsinline,d=void 0!==p&&p,h=e.file,m=this.getProvider();return v.createElement("div",{className:"lm-player-container ".concat(s),ref:this.playContainerRef},v.createElement("div",{className:"player-mask-layout"},v.createElement("video",{autoPlay:t&&!!h,preload:i,muted:o,poster:n,controls:!1,playsInline:d,loop:c})),v.createElement(C,{value:m},this.renderVideoTools()),this.props.children)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.file!==t.file?{file:e.file,playChange:!0}:null}}]),n}();ee.propTypes={file:t.string.isRequired,isLive:t.bool,errorReloadTimer:t.number,type:t.oneOf(["flv","hls","native"]),onInitPlayer:t.func,isDraggable:t.bool,isScale:t.bool,muted:t.string,autoPlay:t.bool,playsInline:t.bool,preload:t.string,poster:t.string,loop:t.bool,snapshot:t.func,className:t.string,playsinline:t.bool,children:t.any,autoplay:t.bool},ee.defaultProps={isLive:!0,isDraggable:!0,isScale:!0,errorReloadTimer:5,muted:"muted",autoPlay:!0,playsInline:!1,preload:"auto",loop:!1};var te,ne=R(Q=function(){function t(e){var d;return s(this,t),(d=m(this,h(t).call(this,e))).reload=function(){var e=d.props.api;d.setState({isEnd:!1,currentTime:e.getCurrentTime()})},d.historyPlayEnd=function(){d.setState({isEnd:!0})},d.getDuration=function(){var e=d.props.api;d.setState({duration:e.getDuration()})},d.getCurrentTime=function(){var e=d.props.api,t={currentTime:e.getCurrentTime(),buffered:e.getSecondsLoaded()};t.buffered===d.state.buffered&&delete t.buffered,d.setState(t)},d.getBuffered=function(){var e=d.props.api;d.setState({buffered:e.getSecondsLoaded()})},d.changePlayTime=function(e){var t=d.props,n=t.seekTo,r=t.historyList,i=r.duration.toString().length,a=(e+i/Math.pow(10,i-1))*r.duration,o=r.fragments.findIndex(function(e){return e.end>a});r.fragments[o].file&&(n(a),d.setState({currentTime:a,isEnd:!1}))},d.seekendPlay=function(){d.props.api.play()},d.renderTimeLineTips=function(e){var t,n,r,i,a,o,l,s,u=d.props.historyList,c=e*u.duration*1e3,p=(t=u.beginDate+c,n=new Date(t),r=n.getFullYear(),i=n.getDate(),a=n.getMonth()+1,o=n.getHours(),l=n.getMinutes(),s=n.getSeconds(),"".concat(r,".").concat(9<a?a:"0"+a,".").concat(9<i?i:"0"+i," ").concat(9<o?o:"0"+o,".").concat(9<l?l:"0"+l,".").concat(9<s?s:"0"+s));return v.createElement("span",null,p)},d.fastForward=function(){d.props.api.fastForward()},d.backWind=function(){d.props.api.backWind()},d.computedLineList=function(e){var t=e.duration;return e.fragments.map(function(e){return{disabled:!e.file,size:(e.end-e.begin)/t*100}})},d.state={duration:1,currentTime:0,buffered:0,isEnd:!1},d}return p(t,v.Component),u(t,[{key:"componentDidMount",value:function(){var e=this.props.event;e.addEventListener("loadedmetadata",this.getDuration),e.addEventListener("durationchange",this.getDuration),e.addEventListener("timeupdate",this.getCurrentTime),e.addEventListener("progress",this.getBuffered),e.addEventListener("suspend",this.getBuffered),e.addEventListener("seeked",this.seekendPlay),e.on(A.HISTORY_PLAY_END,this.historyPlayEnd),e.on(A.RELOAD,this.reload)}},{key:"componentWillUnmount",value:function(){var e=this.props.event;e.removeEventListener("loadedmetadata",this.getDuration),e.removeEventListener("durationchange",this.getDuration),e.removeEventListener("timeupdate",this.getCurrentTime),e.removeEventListener("progress",this.getBuffered),e.removeEventListener("suspend",this.getBuffered),e.removeEventListener("seeked",this.seekendPlay),e.off(A.HISTORY_PLAY_END,this.historyPlayEnd),e.off(A.RELOAD,this.reload),e.off(A.HIDE_CONTRALLER,this.hideContraller),e.off(A.SHOW_CONTRALLER,this.showContraller)}},{key:"render",value:function(){var e=this.props,t=e.historyList,n=e.playIndex,r=e.visibel,i=this.state,a=i.currentTime,o=i.buffered,l=i.isEnd,s=this.computedLineList(t),u=s.filter(function(e,t){return t<n}).map(function(e){return e.size}),c=0===u.length?0:1<u.length?u.reduce(function(e,t){return e+t}):u[0],p=a/t.duration*100+c,d=o/t.duration*100+c;return v.createElement("div",{className:"video-time-line-layout ".concat(r?"":"hide-time-line")},v.createElement(S,{type:"lm-player-PrevFast",onClick:this.backWind,className:"time-line-action-item"}),v.createElement(D,{className:"time-line-box",currentPercent:l?"100":p,availablePercent:d,onChange:this.changePlayTime,renderTips:this.renderTimeLineTips},v.createElement(v.Fragment,null,s.map(function(e,n){var t=s.filter(function(e,t){return t<n}).map(function(e){return e.size}),r=0===t.length?0:1<t.length?t.reduce(function(e,t){return e+t}):t[0];return v.createElement("div",{className:"history-time-line-item ".concat(e.disabled?"history-time-line-disabled":""),key:n,style:{width:"".concat(e.size,"%"),left:"".concat(r,"%")}})}))),v.createElement(S,{type:"lm-player-NextFast_Light",onClick:this.fastForward,className:"time-line-action-item"}))}}]),t}())||Q;ne.propTypes={event:t.object,api:t.object,changePlayIndex:t.func,playIndex:t.number,historyList:t.array,seekTo:t.func,visibel:t.bool};var re=R(te=function(){function a(){var e,t;s(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=m(this,(e=h(a)).call.apply(e,[this].concat(r)))).endedHandle=function(){var e=t.props.playIndex;t.props.changePlayIndex(e+1)},t}return p(a,v.Component),u(a,[{key:"componentDidMount",value:function(){this.props.event.addEventListener("ended",this.endedHandle,!1)}},{key:"componentWillUnmount",value:function(){this.props.event.removeEventListener("ended",this.endedHandle,!1)}},{key:"render",value:function(){return null}}]),a}())||te;re.propTypes={event:t.object,changePlayIndex:t.func,playIndex:t.number};var ie=function(){function t(e){var a;return s(this,t),(a=m(this,h(t).call(this,e))).initPlayer=function(e){var t=a.props.historyList;if(!t||!t.fragments[e]||!t.fragments[e].file)return null;a.flv&&(a.flv.unload(),a.flv.destroy()),a.hls&&(a.hls.stopLoad(),a.hls.destroy()),a.playIndex=e;var n=E(t.fragments[e].file);return"flv"===n||"flv"===a.props.type?(a.flv=g(a.player,{file:t.fragments[e].file}),a.api&&a.api.updateChunk({flv:a.flv})):"m3u8"===n||"hls"===a.props.type?(a.hls=y(a.player,t.fragments[e].file),a.api&&a.api.updateChunk({hls:a.hls})):a.player.src=t.fragments[e].file,a.forceUpdate()},a.changePlayIndex=function(e){var t=a.props.historyList;return t&&t.fragments[e]?(t.fragments[e].file?a.initPlayer(e):a.changePlayIndex(e+1),a.api&&a.api.play(),a.event&&a.event.emit(A.CHANGE_PLAY_INDEX,e),!0):(a.event&&a.event.emit(A.HISTORY_PLAY_END),!1)},a.getPlayerApiContext=function(){return a.api&&a.event?Object.assign({},a.api.getApi(),a.event.getApi(),{seekTo:a.seekTo}):{}},a.computedIndexFormTime=function(t){return a.props.historyList.fragments.findIndex(function(e){return e.end>t})},a.seekTo=function(e){var t=a.props.historyList,n=a.computedIndexFormTime(e),r=t.fragments[n];if(r){var i=e-r.begin-1;a.api&&a.api.pause(),n===a.playIndex&&a.api||a.changePlayIndex(n),a.api.seekTo(i,!0),a.event.emit(A.SEEK,e)}},a.reloadHistory=function(){a.changePlayIndex(0),a.api.seekTo(0),a.event.emit(A.RELOAD),a.api.play()},a.getProvider=function(){return{video:a.player,event:a.event,playerProps:a.props,api:a.api,playContainer:a.playContainer,changePlayIndex:a.changePlayIndex,playIndex:a.playIndex,historyList:a.props.historyList,seekTo:a.seekTo,isHistory:!0,reloadHistory:a.reloadHistory}},a.renderVideoTools=function(){var e=a.getCurrentFile();return a.isInit&&e&&a.api&&a.event?v.createElement(v.Fragment,null,v.createElement(U,null),v.createElement(z,{flvPlayer:a.flv,hlsPlayer:a.hls,key:e}),v.createElement(X,null),v.createElement(H,null,v.createElement(M,null),v.createElement(ne,null)),v.createElement(re,null)):v.createElement(q,null)},a.playIndex=0,a.player=null,a.event=null,a.flv=null,a.hls=null,a.playContainerRef=v.createRef(),a.playContainer=null,a.state={playChange:!1,historyList:[]},a}return p(t,v.Component),u(t,[{key:"componentDidMount",value:function(){this.playContainer=this.playContainerRef.current,this.player=this.playContainer.querySelector("video"),this.isInit=!0,this.createPlayer()}},{key:"componentDidUpdate",value:function(){this.state.playChange&&(this.setState({playChange:!1}),this.playIndex=0,this.createPlayer())}},{key:"componentWillUnmount",value:function(){this.event&&this.event.destroy(),this.api&&this.api.destroy(),this.player=null,this.event=null,this.api=null,this.playContainerRef=null,this.playContainer=null,this.flv=null,this.hls=null}},{key:"createPlayer",value:function(){var e=this.props,t=e.defaultTime,n=e.historyList;this.changePlayIndex(this.playIndex)&&(this.event=new a(this.player),this.api=new K(this.player,this.playContainer,this.event,this.flv,this.hls),this.props.onInitPlayer&&this.props.onInitPlayer(this.getPlayerApiContext()),t&&this.seekTo((t-n.beginDate)/1e3))}},{key:"getErrorKey",value:function(){return this.getCurrentFile()||Math.random().toString(36).substr(2)}},{key:"getCurrentFile",value:function(){var e;try{e=this.props.historyList.fragments[this.playIndex].file}catch(e){console.warn(e)}return e}},{key:"render",value:function(){var e=this.props,t=e.autoplay,n=e.poster,r=e.preload,i=e.muted,a=void 0===i?"muted":i,o=e.loop,l=void 0!==o&&o,s=e.className,u=void 0===s?"":s,c=e.playsinline,p=void 0!==c&&c,d=this.getProvider(),h=this.getCurrentFile();return v.createElement("div",{className:"lm-player-container ".concat(u),ref:this.playContainerRef},v.createElement("div",{className:"player-mask-layout"},v.createElement("video",{autoPlay:t&&!!h,preload:r,muted:a,poster:n,controls:!1,playsInline:p,loop:l})),v.createElement(C,{value:d},this.renderVideoTools()),this.props.children)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.historyList!==t.historyList?{historyList:e.historyList,playChange:!0}:null}}]),t}();ie.propTypes={historyList:t.object.isRequired,isLive:t.bool,errorReloadTimer:t.number,type:t.oneOf(["flv","hls","native"]),onInitPlayer:t.func,isDraggable:t.bool,isScale:t.bool,muted:t.string,autoPlay:t.bool,playsInline:t.bool,preload:t.string,poster:t.string,loop:t.bool,defaultTime:t.number,className:t.string,playsinline:t.bool,children:t.any,autoplay:t.bool},ie.defaultProps={isLive:!0,isDraggable:!0,isScale:!0,errorReloadTimer:5,muted:"muted",autoPlay:!0,playsInline:!1,preload:"auto",loop:!1,defaultTime:0},e.Bar=I,e.HistoryPlayer=ie,e.Player=ee,e.createHistoryPlayer=function(e){var t=e.container,n=e.children,r=e.onInitPlayer,i=d(e,["container","children","onInitPlayer"]);o.render(v.createElement(ie,c({},i,{onInitPlayer:function(e){e.destroy=function(){o.unmountComponentAtNode(t)},r&&r(e)}}),n),t)},e.createPlayer=function(e){var t=e.container,n=e.children,r=e.onInitPlayer,i=d(e,["container","children","onInitPlayer"]);o.render(v.createElement(ee,c({},i,{onInitPlayer:function(e){e.destroy=function(){o.unmountComponentAtNode(t)},r&&r(e)}}),n),t)},e.default=ee,Object.defineProperty(e,"__esModule",{value:!0})});
