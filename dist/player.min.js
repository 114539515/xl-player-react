!function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("react"),require("react-dom"),require("hls.js"),require("flv.lm.js")):"function"===typeof define&&define.amd?define("LMPlayer",["react","react-dom","hls.js","flv.lm.js"],t):"object"===typeof exports?exports.LMPlayer=t(require("react"),require("react-dom"),require("hls.js"),require("flv.lm.js")):e.LMPlayer=t(e.React,e.ReactDOM,e.Hls,e.flvjs)}(window,function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e){return(o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return(l="function"===typeof Symbol&&"symbol"===o(Symbol.iterator)?function(e){return o(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":o(e)})(e)}function s(e,t){return!t||"object"!==l(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}n.r(t);var p=n(0),h=n.n(p),m=n(1),f=n.n(m),v=function(){function e(t){r(this,e),this.video=t,this.events={},this.playerEvents={}}return a(e,[{key:"on",value:function(e,t){this.events&&this.events[e]?this.events[e].listener.push(t):this.events[e]={type:e,listener:[t]}}},{key:"addEventListener",value:function(e,t){this.video&&(this.playerEvents[e]?this.playerEvents[e].push(t):this.playerEvents[e]=[t],this.video.addEventListener(e,t,!1))}},{key:"removeEventListener",value:function(e,t){if(this.video){if(!this.playerEvents||this.playerEvents[e])return;var n=this.playerEvents[e].findIndex(function(e){return e===t});n>-1&&this.playerEvents[e].splice(n,1),this.video.removeEventListener(e,t,!1)}}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.events&&this.events[e]&&this.events[e].listener.forEach(function(e){e.apply(void 0,n)})}},{key:"off",value:function(e,t){if(this.events&&this.events.eventName){var n=this.events[e].listener.findIndex(function(e){return e===t});n>-1&&this.events[e].listener.splice(n,1)}}},{key:"destroy",value:function(){var e=this;Object.keys(this.playerEvents).forEach(function(t){e.playerEvents[t].forEach(function(n){e.removeEventListener(t,n)})}),this.playerEvents=null,this.events=null}}]),e}(),y=n(3),E=n.n(y),g=n(2);function L(e,t){if(g.isSupported()){var n=new g({liveDurationInfinity:!0,levelLoadingTimeOut:15e3,fragLoadingTimeOut:25e3,enableWorker:!0});return n.attachMedia(e),n.on(g.Events.MEDIA_ATTACHED,function(){n.loadSource(t),n.on(g.Events.MANIFEST_PARSED,function(){})}),n}}function R(e,t){var n=t.flvOptions,r=void 0===n?{}:n,i=t.flvConfig,a=void 0===i?{}:i;if(E.a.isSupported()){var o=E.a.createPlayer(Object.assign({},r,{type:"flv",url:t.file}),Object.assign({},a,{enableWorker:!0,enableStashBuffer:!1,stashInitialSize:128,isLive:t.isLive||!0}));return o.attachMediaElement(e),o.load(),o}}function C(e){var t=/([^\.\/\\]+)\.(([a-z]|[0-9])+(\?\S+)?)$/i.exec(e);if(t)return t[2].replace(t[4],"")}function P(e){return e&&(document.fullscreenElement===e||document.msFullscreenElement===e||document.mozFullScreenElement===e||document.webkitFullscreenElement===e)||!1}function k(e,t){var n=e?"addEventListener":"removeEventListener";["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"].map(function(e){return document[n](e,t)})}function b(e,t,n){var r,i,a=t,o=e.getBoundingClientRect(),l=o.width,s=o.height;if(1===n)return[0,0];r=l*(n-1)/2/n,i=s*(n-1)/2/n;var u=0,c=0;return a[0]>=0&&a[0]>r&&(u=r),a[0]>=0&&a[0]<r&&(u=a[0]),a[0]<0&&a[0]<-r&&(u=-r),a[0]<0&&a[0]>-r&&(u=a[0]),a[1]>=0&&a[1]>i&&(c=i),a[1]>=0&&a[1]<i&&(c=a[1]),a[1]<0&&a[1]<-i&&(c=-i),a[1]<0&&a[1]>-i&&(c=a[1]),u!==a[0]||c!==a[1]?[u,c]:void 0}function T(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var S=h.a.createContext(null),D=S.Provider,O=S.Consumer;function _(e){var t=function(t){function n(){return r(this,n),s(this,u(n).apply(this,arguments))}return d(n,h.a.Component),a(n,[{key:"render",value:function(){var t=this.props,n=t.forwardRef,r=T(t,["forwardRef"]);return h.a.createElement(O,null,function(t){return h.a.createElement(e,Object.assign({},r,t,{ref:n}))})}}]),n}();return h.a.forwardRef(function(e,n){return h.a.createElement(t,Object.assign({},e,{forwardRef:n}))})}n(5);function I(e){var t=e.type,n=e.className,r=void 0===n?"":n,i=T(e,["type","className"]);return h.a.createElement("i",Object.assign({className:"lm-player-iconfont ".concat(t," ").concat(r)},i))}n(6);var w=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).renderSliderTips=function(e){if(n.props.renderTips){var t=n.layoutDom.getBoundingClientRect(),r=t.x,i=t.width,a=t.top,o=e.pageX,l=(e.pageX-r)/i;l=l<0?0:l>1?1:l,n.setState({tipsX:o,tipsY:a,showTips:!0,tempValue:l})}},n.hideSliderTips=function(){n.setState({showTips:!1})},n.cancelPropagation=function(e){e.stopPropagation()},n.startDrag=function(e){e.stopPropagation(),n.dragFlag=!0,document.body.addEventListener("mousemove",n.moveChange),document.body.addEventListener("mouseup",n.stopDrag)},n.moveChange=function(e){e.stopPropagation();var t=n.computedPositionForEvent(e);n.setState({value:t})},n.stopDrag=function(e){e.stopPropagation(),document.body.removeEventListener("mousemove",n.moveChange),document.body.removeEventListener("mouseup",n.stopDrag),n.dragFlag=!1;var t=n.state.value/100;t=t<0?0:t>1?1:t,n.props.onChange&&n.props.onChange(t)},n.changeCurrentValue=function(e){e.stopPropagation();var t=n.layoutDom.getBoundingClientRect(),r=t.width,i=t.x,a=(e.pageX-i)/r;n.props.onChange&&n.props.onChange(a)},n.sliderDomRef=h.a.createRef(),n.layoutDom=null,n.lineDom=null,n.dragDom=null,n.dragFlag=!1,n.state={value:n.props.currentPercent||0,tempValue:0,showTips:!1,tipsX:0,tipsY:0},n}return d(t,h.a.Component),a(t,[{key:"componentWillReceiveProps",value:function(e){this.dragFlag||this.setState({value:e.currentPercent||0})}},{key:"componentDidMount",value:function(){this.layoutDom=f.a.findDOMNode(this.sliderDomRef.current),this.dragDom=this.layoutDom.querySelector(".drag-change-icon"),this.lineDom=this.layoutDom.querySelector(".slider-content"),this.layoutDom.addEventListener("mousemove",this.renderSliderTips,!1),this.layoutDom.addEventListener("mouseout",this.hideSliderTips,!1),this.lineDom.addEventListener("click",this.changeCurrentValue,!1),this.dragDom.addEventListener("click",this.cancelPropagation,!1),this.dragDom.addEventListener("mousedown",this.startDrag,!1)}},{key:"componentWillUnmount",value:function(){this.layoutDom.removeEventListener("mousemove",this.renderSliderTips,!1),this.layoutDom.removeEventListener("mouseout",this.hideSliderTips,!1),this.lineDom.removeEventListener("click",this.changeCurrentValue,!1),this.dragDom.removeEventListener("click",this.cancelPropagation,!1),this.dragDom.removeEventListener("mousedown",this.startDrag,!1),document.body.removeEventListener("mousemove",this.moveChange),document.body.removeEventListener("mouseup",this.stopDrag),this.sliderDomRef=null,this.layoutDom=null,this.lineDom=null,this.dragDom=null,this.dragFlag=null}},{key:"computedPositionForEvent",value:function(e){var t=this.layoutDom.getBoundingClientRect(),n=t.x,r=t.width,i=e.pageX-n;return i>r&&(i=r),i<0&&(i=0),i/r*100}},{key:"render",value:function(){var e=this.state,t=e.value,n=e.showTips,r=e.tipsX,i=e.tipsY,a=this.props,o=a.availablePercent,l=void 0===o?0:o,s=a.className,u=void 0===s?"":s;return h.a.createElement("div",{className:"slider-layout ".concat(u),ref:this.sliderDomRef},h.a.createElement("div",{className:"slider-content"},h.a.createElement("div",{className:"slider-max-line"}),h.a.createElement("div",{className:"slider-visibel-line",style:{width:"".concat(l,"%")}}),h.a.createElement("div",{className:"slider-current-line",style:{width:"".concat(t,"%")}}),this.props.children),h.a.createElement("div",{className:"slider-other-content"},h.a.createElement("div",{className:"drag-change-icon",draggable:!1,style:{left:"".concat(t,"%")}})),h.a.createElement(A,{visibel:n,className:"lm-player-slide-tips",style:{left:r,top:i}},this.props.renderTips&&this.props.renderTips(this.state.tempValue)))}}]),t}(),A=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).ele=document.createElement("div"),n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){document.body.appendChild(this.ele)}},{key:"componentWillUnmount",value:function(){document.body.removeChild(this.ele),this.ele=null}},{key:"render",value:function(){var e=this.props,t=e.visibel,n=e.children,r=e.style,i=e.className,a=void 0===i?"":i;return f.a.createPortal(t?h.a.createElement("div",{className:a,style:r},n):null,this.ele)}}]),t}(),N=w;function x(e){var t=e.visibel,n=void 0===t||t,r=e.className,i=e.children,a=T(e,["visibel","className","children"]);return!1===n?null:h.a.createElement("span",Object.assign({className:"contraller-bar-item ".concat(r)},a),i)}var F,M,H,j,W,U,B,q,Y,V={RELOAD:"reload",RELOAD_FAIL:"reloadFail",RELOAD_SUCCESS:"reloadSuccess",ERROR:"error",ERROR_RELOAD:"errorRload",HISTORY_PLAY_END:"historyPlayEnd",SEEK:"seek",TRANSFORM:"transform",CHANGE_PLAY_INDEX:"changePlayIndex",HIDE_CONTRALLER:"hideContraller",SHOW_CONTRALLER:"showContraller",CLEAR_ERROR_TIMER:"clearErrorTimer"},X=_(F=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).seek=function(){n.historyEnd=!1},n.historyPlayEnd=function(){n.historyEnd=!0},n.updateRender=function(){n.mounted&&n.forceUpdate()},n.changePlayStatus=function(){var e=n.props,t=e.api,r=e.video;n.historyEnd?n.props.reloadHistory():r.paused?t.play():t.pause()},n.mutedChange=function(){var e=n.props,t=e.api;e.video.muted?t.unmute():t.mute()},n.volumechange=function(){n.forceUpdate()},n.openSliderVolume=function(){n.setState({openSliderVolume:!0})},n.closeSliderVolume=function(){n.setState({openSliderVolume:!1})},n.onChangeVolume=function(e){var t=n.props,r=t.api,i=t.video;r.setVolume(parseFloat(e.toFixed(1))),e>0&&i.muted&&r.unmute()},n.reload=function(){n.props.isHistory?n.props.reloadHistory():n.props.api.reload(),n.props.event.emit(V.CLEAR_ERROR_TIMER)},n.state={openSliderVolume:!1},n.historyEnd=!1,n.mounted=!1,n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props.event;this.mounted=!0,e.addEventListener("play",this.updateRender),e.addEventListener("pause",this.updateRender),e.addEventListener("volumechange",this.volumechange),e.on(V.HISTORY_PLAY_END,this.historyPlayEnd),e.on(V.SEEK,this.seek)}},{key:"componentWillUnmount",value:function(){var e=this.props.event;this.mounted=!1,e.removeEventListener("play",this.updateRender),e.removeEventListener("pause",this.updateRender),e.removeEventListener("volumechange",this.volumechange),e.off(V.HISTORY_PLAY_END,this.historyPlayEnd),e.off(V.SEEK,this.seek)}},{key:"render",value:function(){var e=this.state.openSliderVolume,t=this.props,n=t.video,r=t.playerProps,i=1===n.volume?"lm-player-volume-max":"lm-player-volume-normal-fuben";return h.a.createElement("div",{className:"contraller-left-bar"},h.a.createElement(x,{visibel:!r.isLive},h.a.createElement(I,{onClick:this.changePlayStatus,type:n.paused?"lm-player-Play_Main":"lm-player-Pause_Main",title:n.paused?"\u64ad\u653e":"\u6682\u505c"})),h.a.createElement(x,{className:"contraller-bar-volume ".concat(e?"contraller-bar-hover-volume":""),onMouseOver:this.openSliderVolume,onMouseOut:this.closeSliderVolume},h.a.createElement(I,{onClick:this.mutedChange,type:n.muted?"lm-player-volume-close":i,title:"\u97f3\u91cf"}),h.a.createElement("div",{className:"volume-slider-layout"},h.a.createElement(N,{className:"volume-slider",currentPercent:n.muted?0:100*n.volume,onChange:this.onChangeVolume,renderTips:function(e){return h.a.createElement("span",null,Math.round(100*e),"%")}}))),h.a.createElement(x,null,h.a.createElement(I,{onClick:this.reload,type:"lm-player-Refresh_Main",title:"\u91cd\u8f7d"})))}}]),t}())||F,z=_(M=function(e){function t(){var e,n;r(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(n=s(this,(e=u(t)).call.apply(e,[this].concat(a)))).update=function(){n.forceUpdate()},n.fullscreen=function(){var e=n.props,t=e.api;P(e.playContainer)?t.cancelFullScreen():t.requestFullScreen(),n.forceUpdate()},n.setScale=function(){var e=n.props,t=e.api,r=e.playContainer.querySelector(".player-mask-layout");t.setScale.apply(t,arguments);var i=b(r,t.getPosition(),t.getScale());i&&t.setPosition(i,!0)},n.snapshot=function(){var e=n.props,t=e.api,r=e.playerProps;r.snapshot&&r.snapshot(t.snapshot())},n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){k(!0,this.update)}},{key:"componentWillUnmount",value:function(){k(!1,this.update)}},{key:"render",value:function(){var e=this,t=this.props,n=t.playContainer,r=t.playerProps,i=r.isScale,a=r.snapshot,o=P(n);return h.a.createElement("div",{className:"contraller-right-bar"},i&&h.a.createElement(h.a.Fragment,null,h.a.createElement("span",{className:"contraller-bar-item"},h.a.createElement(I,{title:"\u7f29\u5c0f",onClick:function(){return e.setScale(-.2)},type:"lm-player-ZoomOut_Main"})),h.a.createElement("span",{className:"contraller-bar-item"},h.a.createElement(I,{title:"\u590d\u4f4d",onClick:function(){return e.setScale(1,!0)},type:"lm-player-ZoomDefault_Main"})),h.a.createElement("span",{className:"contraller-bar-item"},h.a.createElement(I,{title:"\u653e\u5927",onClick:function(){return e.setScale(.2)},type:"lm-player-ZoomIn_Main"}))),a&&h.a.createElement("span",{className:"contraller-bar-item"},h.a.createElement(I,{title:"\u622a\u56fe",onClick:this.snapshot,type:"lm-player-SearchBox"})),h.a.createElement("span",{className:"contraller-bar-item"},h.a.createElement(I,{title:o?"\u7a97\u53e3":"\u5168\u5c4f",onClick:this.fullscreen,type:o?"lm-player-ExitFull_Main":"lm-player-Full_Main"})))}}]),t}())||M,K=(n(7),_(H=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).hideContraller=function(){n.setState({hideBar:!0})},n.showContraller=function(){n.setState({hideBar:!1})},n.state={hideBar:!1},n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props.event;e.on(V.HIDE_CONTRALLER,this.hideContraller),e.on(V.SHOW_CONTRALLER,this.showContraller)}},{key:"componentWillUnmount",value:function(){var e=this.props.event;e.off(V.HIDE_CONTRALLER,this.hideContraller),e.off(V.SHOW_CONTRALLER,this.showContraller)}},{key:"render",value:function(){return h.a.createElement("div",{className:"contraller-bar-layout ".concat(this.state.hideBar?"hide-contraller-bar":"")},h.a.createElement(X,null),h.a.createElement(z,null))}}]),t}())||H),G=_(j=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).showContraller=function(){n.props.event.emit(V.SHOW_CONTRALLER),n.hideContraller()},n.hideContraller=function(){var e=n.props.event;clearTimeout(n.timer),n.timer=setTimeout(function(){e.emit(V.HIDE_CONTRALLER)},3e3)},n.timer=null,n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.playContainer,n=e.event;t.addEventListener("mousemove",this.showContraller,!1),t.addEventListener("mouseout",this.hideContraller,!1),this.timer=setTimeout(function(){n.emit(V.HIDE_CONTRALLER)},5e3)}},{key:"componentWillUnmount",value:function(){var e=this.props.playContainer;e.addEventListener("mousemove",this.showContraller,!1),e.addEventListener("mouseout",this.hideContraller,!1),clearTimeout(this.timer)}},{key:"render",value:function(){return null}}]),t}())||j,Z=(n(8),_(W=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).clearReloadMessage=function(){n.message=null,n.forceUpdate()},n.reload=function(){n.setState({status:"reload"})},n.errorReload=function(e){n.message=h.a.createElement("div",null,"\u89c6\u9891\u52a0\u8f7d\u9519\u8bef\uff0c\u6b63\u5728\u8fdb\u884c\u91cd\u8fde\u7b2c",e,"\u91cd\u8fde"),n.setState({status:"reload",loading:!0})},n.reloadFail=function(){n.message=h.a.createElement("div",null,"\u89c6\u9891\u9519\u8bef"),n.setState({status:"fail"})},n.reloadSuccess=function(){n.message=null,n.setState({status:null})},n.openLoading=function(){n.setState({loading:!0})},n.closeLoading=function(){n.setState({loading:!1})},n.historyPlayEnd=function(){n.message=null,n.setState({status:null,loading:!1}),n.props.api.pause()},n.state={loading:!1,status:null},n.message=null,n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props.event;e.addEventListener("loadstart",this.openLoading),e.addEventListener("waiting",this.openLoading),e.addEventListener("seeking",this.openLoading),e.addEventListener("loadeddata",this.closeLoading),e.addEventListener("canplay",this.closeLoading),e.on(V.ERROR_RELOAD,this.errorReload),e.on(V.RELOAD_FAIL,this.reloadFail),e.on(V.RELOAD_SUCCESS,this.reloadSuccess),e.on(V.RELOAD,this.reload),e.on(V.HISTORY_PLAY_END,this.historyPlayEnd),e.on(V.CLEAR_ERROR_TIMER,this.clearReloadMessage)}},{key:"componentWillUnmount",value:function(){var e=this.props.event;e.removeEventListener("loadstart",this.openLoading),e.removeEventListener("waiting",this.openLoading),e.removeEventListener("seeking",this.openLoading),e.removeEventListener("loadeddata",this.closeLoading),e.removeEventListener("canplay",this.closeLoading),e.off(V.ERROR_RELOAD,this.errorReload),e.off(V.RELOAD_FAIL,this.reloadFail),e.off(V.RELOAD_SUCCESS,this.reloadSuccess),e.off(V.RELOAD,this.reload),e.off(V.HISTORY_PLAY_END,this.historyPlayEnd),e.off(V.CLEAR_ERROR_TIMER,this.clearReloadMessage)}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.status;return h.a.createElement("div",{className:"lm-player-message-mask ".concat(t||"fail"===n?"lm-player-mask-loading-animation":"")},h.a.createElement(I,{type:"fail"===n?"lm-player-YesorNo_No_Dark":"lm-player-Loading",className:"".concat(t&&"fail"!==n?"lm-player-loading-animation":"fail"===n?"lm-player-loadfail":""," lm-player-loading-icon")}),h.a.createElement("span",{className:"lm-player-message"},this.message))}}]),t}())||W),$=(n(4),_(U=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).hideContraller=function(){n.setState({hideBar:!0})},n.showContraller=function(){n.setState({hideBar:!1})},n.getDuration=function(){var e=n.props.api;n.setState({duration:e.getDuration()})},n.getCurrentTime=function(){var e=n.props.api,t={currentTime:e.getCurrentTime(),buffered:e.getSecondsLoaded()};t.buffered===n.state.buffered&&delete t.buffered,n.setState(t)},n.getBuffered=function(){var e=n.props.api;n.setState({buffered:e.getSecondsLoaded()})},n.changePlayTime=function(e){var t=n.props.api,r=e*n.state.duration;t.pause(),n.setState({currentTime:r}),t.seekTo(r)},n.seekendPlay=function(){var e=n.props;e.video;e.api.play()},n.renderTimeLineTips=function(e){var t=function(e){var t=Math.ceil(e);if(t>60){var n=Math.ceil(e%60),r=Math.floor(e/60);if(t="".concat(r<10?"0".concat(r):r,":").concat(n<10?"0".concat(n):n),r>60){r=Math.ceil(e/60%60);var i=Math.floor(e/60/60);t="".concat(i<10?"0".concat(i):i,":").concat(r<10?"0".concat(r):r,":").concat(n<10?"0".concat(n):n)}else t="00:".concat(t)}else t="00:00:".concat(t<10?"0".concat(t):t);return t}(e*n.state.duration);return h.a.createElement("span",null,t)},n.fastForward=function(){n.props.api.fastForward()},n.backWind=function(){n.props.api.backWind()},n.state={duration:0,currentTime:0,buffered:0,hideBar:!1},n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props.event;e.addEventListener("loadedmetadata",this.getDuration),e.addEventListener("durationchange",this.getDuration),e.addEventListener("timeupdate",this.getCurrentTime),e.addEventListener("progress",this.getBuffered),e.addEventListener("suspend",this.getBuffered),e.addEventListener("seeked",this.seekendPlay),e.on(V.HIDE_CONTRALLER,this.hideContraller),e.on(V.SHOW_CONTRALLER,this.showContraller)}},{key:"componentWillUnmount",value:function(){var e=this.props.event;e.removeEventListener("loadedmetadata",this.getDuration),e.removeEventListener("durationchange",this.getDuration),e.removeEventListener("timeupdate",this.getCurrentTime),e.removeEventListener("progress",this.getBuffered),e.removeEventListener("suspend",this.getBuffered),e.removeEventListener("seeked",this.seekendPlay),e.off(V.HIDE_CONTRALLER,this.hideContraller),e.off(V.SHOW_CONTRALLER,this.showContraller)}},{key:"render",value:function(){var e=this.state,t=e.duration,n=e.currentTime,r=e.buffered,i=e.hideBar,a=Math.round(n/t*100),o=Math.round(r/t*100);return h.a.createElement("div",{className:"video-time-line-layout ".concat(i?"hide-time-line":"")},h.a.createElement(I,{type:"lm-player-PrevFast",onClick:this.backWind,className:"time-line-action-item"}),h.a.createElement(N,{className:"time-line-box",currentPercent:a,availablePercent:o,onChange:this.changePlayTime,renderTips:this.renderTimeLineTips}),h.a.createElement(I,{type:"lm-player-NextFast_Light",onClick:this.fastForward,className:"time-line-action-item"}))}}]),t}())||U),J=_(B=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).clearErrorTimer=function(){n.errorTimer=0},n.clearError=function(){var e=n.props.event;n.errorTimer>0&&(console.warn("\u89c6\u9891\u91cd\u8fde\u6210\u529f\uff01"),e.emit(V.RELOAD_SUCCESS),n.clearErrorTimer())},n.errorHandle=function(){for(var e,t=n.props,r=t.event,i=t.api,a=t.isHistory,o=t.changePlayIndex,l=t.playIndex,s=t.playerProps,u=n.errorTimer+1,c=arguments.length,d=new Array(c),p=0;p<c;p++)d[p]=arguments[p];(r.emit.apply(r,[V.ERROR].concat(d)),u>s.errorReloadTimer)?(a?o(l+1):r.emit(V.RELOAD_FAIL),i.unload()):(r.emit.apply(r,[V.ERROR_RELOAD,u].concat(d)),(e=console).error.apply(e,["\u89c6\u9891\u64ad\u653e\u51fa\u9519\uff0c\u6b63\u5728\u8fdb\u884c\u91cd\u8fde".concat(u)].concat(d)),n.errorTimer=u,n.reconnectTimer=setTimeout(function(){i.reload()},5e3))},n.errorTimer=0,n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.event,n=e.flvPlayer,r=e.hlsPlayer;n&&n.on(E.a.Events.ERROR,this.errorHandle),r&&r.on(g.Events.ERROR,this.errorHandle),t.addEventListener("error",this.errorHandle,!1),t.addEventListener("canplay",this.clearError,!1),t.on(V.CHANGE_PLAY_INDEX,this.clearErrorTimer),t.on(V.CLEAR_ERROR_TIMER,this.clearErrorTimer)}},{key:"componentWillReceiveProps",value:function(e){e.flvPlayer&&e.flvPlayer!==this.props.flvPlayer&&e.flvPlayer.on(E.a.Events.ERROR,this.errorHandle),e.hlsPlayer&&e.hlsPlayer!==this.props.hlsPlayer&&e.hlsPlayer.on(g.Events.ERROR,this.errorHandle)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.event,n=e.flvPlayer,r=e.hlsPlayer;t.removeEventListener("error",this.errorHandle,!1),n&&n.off(E.a.Events.ERROR,this.errorHandle),r&&r.off(g.Events.ERROR,this.errorHandle),t.off(V.CLEAR_ERROR_TIMER,this.clearErrorTimer),t.off(V.CHANGE_PLAY_INDEX,this.clearErrorTimer),clearTimeout(this.reconnectTimer)}},{key:"render",value:function(){return null}}]),t}())||B,Q=_(q=function(e){function t(e){var n;r(this,t),(n=s(this,u(t).call(this,e))).openDrag=function(e){n.position.start=[e.pageX,e.pageY],n.dragDom.addEventListener("mousemove",n.moveChange),n.dragDom.addEventListener("mouseup",n.stopDrag)},n.moveChange=function(e){var t=n.props.api,r=t.getPosition();n.position.end=[e.pageX,e.pageY];var i=[r[0]+(n.position.end[0]-n.position.start[0]),r[1]+(n.position.end[1]-n.position.start[1])];t.setPosition(i),n.position.start=[e.pageX,e.pageY]},n.stopDrag=function(){n.dragDom.removeEventListener("mousemove",n.moveChange),n.dragDom.removeEventListener("mouseup",n.stopDrag),n.transformChange()},n.transformChange=function(){var e=n.props.api,t=b(n.dragDom,e.getPosition(),e.getScale());t&&e.setPosition(t,!0)};var i=e.playContainer;return n.dragDom=i.querySelector(".player-mask-layout"),n.position={start:[0,0],end:[0,0]},n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){this.props.playerProps.isDraggable&&(this.dragDom.addEventListener("mousedown",this.openDrag),this.props.event.addEventListener("transform",this.transformChange,!0))}},{key:"componentWillUnmount",value:function(){this.dragDom.removeEventListener("mousedown",this.openDrag),this.props.event.removeEventListener("transform",this.transformChange)}},{key:"render",value:function(){return null}}]),t}())||q,ee=function(){function e(t,n,i,a,o){r(this,e),this.player=t,this.playContainer=n,this.flv=a,this.hls=o,this.event=i,this.scale=1,this.position=[0,0]}return a(e,[{key:"updateChunk",value:function(e){var t=e.flv,n=e.hls;this.flv=t,this.hls=n}},{key:"requestFullScreen",value:function(){var e;P(this.playContainer)||((e=this.playContainer).requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen())}},{key:"cancelFullScreen",value:function(){P(this.playContainer)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())}},{key:"play",value:function(){this.player.paused&&this.player.play()}},{key:"pause",value:function(){this.player.paused||this.player.pause()}},{key:"destroy",value:function(){this.player.removeAttribute("src"),this.unload(),this.flv&&this.flv.destroy(),this.hls&&this.hls.destroy(),this.scale=null,this.position=null}},{key:"seekTo",value:function(e,t){var n=this.getBufferedTime();this.flv&&n[0]>e&&(this.flv.unload(),this.flv.load()),this.player.currentTime=e,t||this.event.emit(V.SEEK,e)}},{key:"reload",value:function(){this.unload(),this.load(),this.play(),this.event.emit(V.RELOAD),0!==this.getCurrentTime&&this.seekTo(0)}},{key:"unload",value:function(){this.flv&&this.flv.unload(),this.hls&&this.hls.stopLoad()}},{key:"load",value:function(){this.flv&&this.flv.load(),this.hls&&this.hls.loadSource(this.hls.url)}},{key:"setVolume",value:function(e){this.player.volume=e}},{key:"mute",value:function(){this.player.muted=!0}},{key:"unmute",value:function(){this.player.muted=!1}},{key:"requestPictureInPicture",value:function(){this.player.requestPictureInPicture&&document.pictureInPictureElement!==this.player&&this.player.requestPictureInPicture()}},{key:"exitPictureInPicture",value:function(){document.exitPictureInPicture&&document.pictureInPictureElement===this.player&&document.exitPictureInPicture()}},{key:"setPlaybackRate",value:function(e){this.player.playbackRate=e}},{key:"getDuration",value:function(){if(!this.player)return null;var e=this.player,t=e.duration,n=e.seekable;return t===1/0&&n.length>0?n.end(n.length-1):t}},{key:"getCurrentTime",value:function(){return this.player?this.player.currentTime:null}},{key:"getSecondsLoaded",value:function(){return this.getBufferedTime()[1]}},{key:"getBufferedTime",value:function(){if(!this.player)return null;var e=this.player.buffered;if(0===e.length)return[0,0];var t=e.end(e.length-1),n=e.start(e.length-1),r=this.getDuration();return t>r?r:[n,t]}},{key:"fastForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=this.getDuration(),n=this.getCurrentTime()+e;this.seekTo(n>t-1?t-1:n)}},{key:"backWind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=this.getCurrentTime()-e;this.seekTo(t<1?1:t)}},{key:"snapshot",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.player.videoWidth,e.height=this.player.videoHeight,t.drawImage(this.player,0,0,e.width,e.height),setTimeout(function(){e.remove(),e=null,t=null},200),e.toDataURL()}},{key:"setScale",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.scale+e;n?r=e:(r<1&&(r=1),r>3&&(r=3)),this.scale=r,this.player.style.transition="transform 0.3s",this.__setTransform(),this.event.emit(V.TRANSFORM),setTimeout(function(){t.player.style.transition="unset"},500)}},{key:"getScale",value:function(){return this.scale}},{key:"setPosition",value:function(e,t){this.position=e,this.player.style.transition=t?"transform 0.3s":"unset",this.__setTransform()}},{key:"getPosition",value:function(){return this.position}},{key:"__setTransform",value:function(){this.player.style.transform="scale(".concat(this.scale,") translate(").concat(this.position[0],"px,").concat(this.position[1],"px)")}},{key:"getApi",value:function(){return{play:this.play.bind(this),reload:this.reload.bind(this),pause:this.pause.bind(this),seekTo:this.seekTo.bind(this),setVolume:this.setVolume.bind(this),mute:this.mute.bind(this),unmute:this.unmute.bind(this),requestPictureInPicture:this.requestPictureInPicture.bind(this),exitPictureInPicture:this.exitPictureInPicture.bind(this),setPlaybackRate:this.setPlaybackRate.bind(this),destroy:this.destroy.bind(this),getDuration:this.getDuration.bind(this),getCurrentTime:this.getCurrentTime.bind(this),getSecondsLoaded:this.getSecondsLoaded.bind(this),getBufferedTime:this.getBufferedTime.bind(this),fastForward:this.fastForward.bind(this),backWind:this.backWind.bind(this),snapshot:this.snapshot.bind(this),requestFullScreen:this.requestFullScreen.bind(this),cancelFullScreen:this.cancelFullScreen.bind(this),__player:this.player}}}]),e}(),te=_(Y=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).canplay=function(){var e=n.props.api;n.isCanPlay=!0,e.play()},n.errorHandle=function(){n.isPlayError=!0},n.clearHandle=function(){n.isPlayError=!1},n.updateProgress=function(){n.progressTime=Date.now(),n.focusSeekAction()},n.heartAction=function(){var e=n.props,t=e.api,r=e.event;n.timer=setInterval(function(){var e=Date.now(),i=t.getCurrentTime();!n.isPlayError&&n.isCanPlay&&(i>0?e-n.progressTime>1e4?(console.warn("\u5f53\u524d\u5b9e\u65f6\u89c6\u9891\u7f13\u5b58\u672a\u66f4\u65b0\uff0c\u6267\u884creload\u64cd\u4f5c"),t.reload()):n.errorTimer=0:n.errorTimer>=5?(r.emit(V.RELOAD_FAIL,n.errorTimer),t.unload()):(n.errorTimer++,t.reload(),r.emit(V.ERROR_RELOAD,n.errorTimer)))},5e3)},n.focusSeekAction=function(){var e=n.props.api,t=e.getCurrentTime(),r=e.getSecondsLoaded();r-t>5&&(console.warn("\u5f53\u524d\u5ef6\u65f6\u8fc7\u5927current->".concat(t," buffered->").concat(r,", \u57fa\u4e8e\u89c6\u9891\u5f53\u524d\u7f13\u5b58\u65f6\u95f4\u66f4\u65b0\u5f53\u524d\u64ad\u653e\u65f6\u95f4 updateTime -> ").concat(r-2)),e.seekTo(r-2>0?r-2:0))},n.progressTime=Date.now(),n.timer=null,n.isPlayError=!1,n.errorTimer=0,n.isCanPlay=!1,n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props.event;e.addEventListener("progress",this.updateProgress),e.addEventListener("canplay",this.canplay),e.on(V.ERROR,this.errorHandle),e.on(V.RELOAD_SUCCESS,this.clearHandle),this.heartAction()}},{key:"componentWillUnmount",value:function(){var e=this.props.event;e.removeEventListener("progress",this.updateProgress),e.removeEventListener("canplay",this.canplay),e.off(V.ERROR,this.errorHandle),e.off(V.RELOAD_SUCCESS,this.clearHandle),clearInterval(this.timer)}},{key:"render",value:function(){return null}}]),t}())||Y,ne=(n(9),function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).initPlayer=function(){if(!n.props.file)return null;var e=C(n.props.file);"flv"===e||"flv"===n.props.type?n.flv=R(n.player,n.props):"m3u8"===e||"hls"===n.props.type?n.hls=L(n.player,n.props.file):n.player.src=n.props.file},n.renderVideoTools=function(){return n.player?h.a.createElement(h.a.Fragment,null,h.a.createElement(K,null),h.a.createElement(Z,null),h.a.createElement(Q,null),h.a.createElement(G,null),h.a.createElement(J,{flvPlayer:n.flv,hlsPlayer:n.hls}),n.props.isLive?h.a.createElement(te,{key:n.props.file}):h.a.createElement($,null)):null},n.getPlayUrl=function(){return n.props.file},n.getPlayerApiContext=function(){var e=n.api?n.api.getApi():{},t=n.event?{on:n.event.on.bind(n.event),off:n.event.off.bind(n.event),emit:n.event.emit.bind(n.event)}:{};return Object.assign({},e,t,{getPlayUrl:n.getPlayUrl,playContainer:n.playContainer})},n.getProvider=function(){return{video:n.player,event:n.event,playerProps:n.props,api:n.api,playContainer:n.playContainer}},n.player=null,n.event=null,n.flv=null,n.hls=null,n.playContainerRef=h.a.createRef(),n.playContainer=null,n.willReCreatePlayer=!1,n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){this.playContainer=f.a.findDOMNode(this.playContainerRef.current),this.player=this.playContainer.querySelector("video"),this.initPlayer(),this.event=new v(this.player),this.api=new ee(this.player,this.playContainer,this.event,this.flv,this.hls),this.forceUpdate(),this.props.onInitPlayer&&this.props.onInitPlayer(this.getPlayerApiContext()),this.props.autoPlay&&this.api.play()}},{key:"componentWillReceiveProps",value:function(e){this.props.file!==e.file&&(this.willReCreatePlayer=!0)}},{key:"componentDidUpdate",value:function(){this.willReCreatePlayer&&(this.initPlayer(),this.willReCreatePlayer=!1)}},{key:"componentWillUnmount",value:function(){var e=this;this.event.destroy(),this.player=null,this.event=null,setTimeout(function(){e.api.destroy(),e.flv=null,e.hls=null},200),this.playContainerRef=null,this.playContainer=null,this.willReCreatePlayer=null}},{key:"render",value:function(){var e=this.props,t=e.autoplay,n=e.poster,r=e.preload,i=void 0===r?"none":r,a=e.muted,o=void 0===a?"muted":a,l=e.loop,s=void 0!==l&&l,u=e.playsinline,c=void 0!==u&&u,d=this.getProvider();return h.a.createElement("div",{className:"lm-player-container",ref:this.playContainerRef},h.a.createElement("div",{className:"player-mask-layout"},h.a.createElement("video",{autoPlay:t,preload:i,muted:o,poster:n,controls:!1,playsInline:c,loop:s})),h.a.createElement(D,{value:d},this.renderVideoTools()),this.props.children)}}]),t}());ne.defaultProps={isLive:!0,isDraggable:!0,isScale:!0,errorReloadTimer:5,muted:"muted",autoPlay:!0,playsInline:!1,preload:"auto",loop:!1};var re,ie,ae=ne,oe=_(re=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).hideContraller=function(){n.setState({hideBar:!0})},n.showContraller=function(){n.setState({hideBar:!1})},n.reload=function(){var e=n.props.api;n.setState({isEnd:!1,currentTime:e.getCurrentTime()})},n.historyPlayEnd=function(){n.setState({isEnd:!0})},n.getDuration=function(){var e=n.props.api;n.setState({duration:e.getDuration()})},n.getCurrentTime=function(){var e=n.props.api,t={currentTime:e.getCurrentTime(),buffered:e.getSecondsLoaded()};t.buffered===n.state.buffered&&delete t.buffered,n.setState(t)},n.getBuffered=function(){var e=n.props.api;n.setState({buffered:e.getSecondsLoaded()})},n.changePlayTime=function(e){var t=n.props,r=t.seekTo,i=t.historyList,a=e*i.duration,o=i.fragments.findIndex(function(e){return e.end>a});i.fragments[o].file&&(r(a),n.setState({currentTime:a,isEnd:!1}))},n.seekendPlay=function(){n.props.api.play()},n.renderTimeLineTips=function(e){var t=n.props.historyList,r=e*t.duration*1e3,i=function(e){var t=new Date(e),n=t.getFullYear(),r=t.getDate(),i=t.getMonth()+1,a=t.getHours(),o=t.getMinutes(),l=t.getSeconds();return"".concat(n,".").concat(i>10?i:"0"+i,".").concat(r>10?r:"0"+r," ").concat(a>10?a:"0"+a,".").concat(o>10?o:"0"+o,".").concat(l>10?l:"0"+l)}(new Date(t.beginDate).getTime()+r);return h.a.createElement("span",null,i)},n.fastForward=function(){n.props.api.fastForward()},n.backWind=function(){n.props.api.backWind()},n.computedLineList=function(e){var t=e.duration;return e.fragments.map(function(e){return{disabled:!e.file,size:(e.end-e.begin)/t*100}})},n.state={duration:1,currentTime:0,buffered:0,isEnd:!1,hideBar:!1},n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){var e=this.props.event;e.addEventListener("loadedmetadata",this.getDuration),e.addEventListener("durationchange",this.getDuration),e.addEventListener("timeupdate",this.getCurrentTime),e.addEventListener("progress",this.getBuffered),e.addEventListener("suspend",this.getBuffered),e.addEventListener("seeked",this.seekendPlay),e.on(V.HISTORY_PLAY_END,this.historyPlayEnd),e.on(V.RELOAD,this.reload),e.on(V.HIDE_CONTRALLER,this.hideContraller),e.on(V.SHOW_CONTRALLER,this.showContraller)}},{key:"componentWillUnmount",value:function(){var e=this.props.event;e.removeEventListener("loadedmetadata",this.getDuration),e.removeEventListener("durationchange",this.getDuration),e.removeEventListener("timeupdate",this.getCurrentTime),e.removeEventListener("progress",this.getBuffered),e.removeEventListener("suspend",this.getBuffered),e.removeEventListener("seeked",this.seekendPlay),e.off(V.HISTORY_PLAY_END,this.historyPlayEnd),e.off(V.RELOAD,this.reload),e.off(V.HIDE_CONTRALLER,this.hideContraller),e.off(V.SHOW_CONTRALLER,this.showContraller)}},{key:"render",value:function(){var e=this.props,t=e.historyList,n=e.playIndex,r=this.state,i=r.currentTime,a=r.buffered,o=r.isEnd,l=r.hideBar,s=this.computedLineList(t),u=s.filter(function(e,t){return t<n}).map(function(e){return e.size}),c=0===u.length?0:u.length>1?u.reduce(function(e,t){return e+t}):u[0],d=Math.round(i/t.duration*100+c),p=Math.round(a/t.duration*100+c);return h.a.createElement("div",{className:"video-time-line-layout ".concat(l?"hide-time-line":"")},h.a.createElement(I,{type:"lm-player-PrevFast",onClick:this.backWind,className:"time-line-action-item"}),h.a.createElement(N,{className:"time-line-box",currentPercent:o?"100":d,availablePercent:p,onChange:this.changePlayTime,renderTimeLineTips:this.renderTimeLineTips},h.a.createElement(h.a.Fragment,null,s.map(function(e,t){var n=s.filter(function(e,n){return n<t}).map(function(e){return e.size}),r=0===n.length?0:n.length>1?n.reduce(function(e,t){return e+t}):n[0];return h.a.createElement("div",{className:"history-time-line-item ".concat(e.disabled?"history-time-line-disabled":""),key:t,style:{width:"".concat(e.size,"%"),left:"".concat(r,"%")}})}))),h.a.createElement(I,{type:"lm-player-NextFast_Light",onClick:this.fastForward,className:"time-line-action-item"}))}}]),t}())||re,le=_(ie=function(e){function t(){var e,n;r(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(n=s(this,(e=u(t)).call.apply(e,[this].concat(a)))).endedHandle=function(){var e=n.props.playIndex;n.props.changePlayIndex(e+1)},n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){this.props.event.addEventListener("ended",this.endedHandle,!1)}},{key:"componentWillUnmount",value:function(){this.props.event.removeEventListener("ended",this.endedHandle,!1)}},{key:"render",value:function(){return null}}]),t}())||ie,se=function(e){function t(e){var n;return r(this,t),(n=s(this,u(t).call(this,e))).initPlayer=function(e){var t=n.props.historyList;if(!t||!t.fragments[e]||!t.fragments[e].file)return null;n.flv&&(n.flv.unload(),n.flv.destroy(),n.flv=null),n.hls&&(n.hls.stopLoad(),n.hls.destroy(),n.hls=null);var r=C(t.fragments[e].file);"flv"===r||"flv"===n.props.type?(n.flv=R(n.player,{file:t.fragments[e].file}),n.api&&n.api.updateChunk({flv:n.flv})):"m3u8"===r||"hls"===n.props.type?(n.hls=L(n.player,t.fragments[e].file),n.api&&n.api.updateChunk({hls:n.hls})):n.player.src=t.fragments[e].file,n.playIndex=e,n.forceUpdate()},n.changePlayIndex=function(e){var t=n.props.historyList;t.fragments[e]?(t.fragments[e].file?n.initPlayer(e):n.changePlayIndex(e+1),n.api.play(),n.event.emit(V.CHANGE_PLAY_INDEX,e)):n.event.emit(V.HISTORY_PLAY_END)},n.getPlayerApiContext=function(){var e=n.api?n.api.getApi():{},t=n.event?{on:n.event.on.bind(n.event),off:n.event.off.bind(n.event),emit:n.event.emit.bind(n.event)}:{},r={seekTo:n.seekTo};return Object.assign({},e,t,r)},n.computedIndexFormTime=function(e){return n.props.historyList.fragments.findIndex(function(t){return t.end>e})},n.seekTo=function(e){var t=n.computedIndexFormTime(e),r=e-historyList.fragments[t].begin-1;n.api.pause(),t!==n.playIndex&&n.changePlayIndex(t),n.api.seekTo(r,!0),n.event.emit(V.SEEK,e)},n.reloadHistory=function(){n.changePlayIndex(0),n.api.seekTo(0),n.event.emit(V.RELOAD),n.api.play()},n.getProvider=function(){return{video:n.player,event:n.event,playerProps:n.props,api:n.api,playContainer:n.playContainer,changePlayIndex:n.changePlayIndex,playIndex:n.playIndex,historyList:n.props.historyList,seekTo:n.seekTo,isHistory:!0,reloadHistory:n.reloadHistory}},n.renderVideoTools=function(){return n.player?h.a.createElement(h.a.Fragment,null,h.a.createElement(K,null),h.a.createElement(Z,null),h.a.createElement(oe,null),h.a.createElement(G,null),h.a.createElement(J,{flvPlayer:n.flv,hlsPlayer:n.hls}),h.a.createElement(Q,null),h.a.createElement(le,null)):null},n.playIndex=0,n.player=null,n.event=null,n.flv=null,n.hls=null,n.playContainerRef=h.a.createRef(),n.playContainer=null,n.willReCreatePlayer=!1,n}return d(t,h.a.Component),a(t,[{key:"componentDidMount",value:function(){this.playContainer=f.a.findDOMNode(this.playContainerRef.current),this.player=this.playContainer.querySelector("video"),this.props.defaultTime?this.seekTo(defaultTime):this.initPlayer(this.playIndex),this.event=new v(this.player),this.api=new ee(this.player,this.playContainer,this.event,this.flv,this.hls),this.props.onInitPlayer&&this.props.onInitPlayer(this.getPlayerApiContext()),this.props.autoPlay&&this.api.play()}},{key:"componentWillReceiveProps",value:function(e){this.props.historyList!==e.historyList&&(this.willReCreatePlayer=!0)}},{key:"componentDidUpdate",value:function(){this.willReCreatePlayer&&(this.playIndex=0,this.initPlayer(this.playIndex),this.willReCreatePlayer=!1)}},{key:"componentWillUnmount",value:function(){var e=this;this.event.destroy(),this.player=null,this.event=null,setTimeout(function(){e.api.destroy(),e.flv=null,e.hls=null},200),this.playContainerRef=null,this.playContainer=null,this.willReCreatePlayer=null}},{key:"render",value:function(){var e=this.props,t=e.autoplay,n=e.poster,r=e.preload,i=e.muted,a=void 0===i?"muted":i,o=e.loop,l=void 0!==o&&o,s=e.playsinline,u=void 0!==s&&s,c=this.getProvider();return h.a.createElement("div",{className:"lm-player-container",ref:this.playContainerRef},h.a.createElement("div",{className:"player-mask-layout"},h.a.createElement("video",{autoPlay:t,preload:r,muted:a,poster:n,controls:!1,playsInline:u,loop:l})),h.a.createElement(D,{value:c},this.renderVideoTools()),this.props.children)}}]),t}();se.defaultProps={isLive:!0,isDraggable:!0,isScale:!0,errorReloadTimer:5,muted:"muted",autoPlay:!0,playsInline:!1,preload:"auto",loop:!1,defaultTime:0};var ue=se;function ce(e){var t=e.container,n=e.children,r=e.onInitPlayer,i=T(e,["container","children","onInitPlayer"]);f.a.render(h.a.createElement(ae,Object.assign({},i,{onInitPlayer:function(e){e.destroy=function(){f.a.unmountComponentAtNode(t)},r&&r(e)}}),n),t)}function de(e){var t=e.container,n=e.children,r=e.onInitPlayer,i=T(e,["container","children","onInitPlayer"]);f.a.render(h.a.createElement(ue,Object.assign({},i,{onInitPlayer:function(e){e.destroy=function(){f.a.unmountComponentAtNode(t)},r&&r(e)}}),n),t)}n.d(t,"default",function(){return ae}),n.d(t,"HistoryPlayer",function(){return ue}),n.d(t,"createHistoryPlayer",function(){return de}),n.d(t,"createPlayer",function(){return ce})}])});
//# sourceMappingURL=player.min.js.map